@using System.Web.Mvc;
@using ODK.Umbraco.Content;
@using ODK.Umbraco.Members;
@using ODK.Umbraco.Web.Mvc;
@inherits ODK.Umbraco.Web.Mvc.OdkUmbracoTemplatePage
@{
    Layout = "Master.cshtml";

    if (CurrentMember != null)
    {
        Response.Redirect(Model.Content.Parent.Url);
        return;
    }

    string registerButtonText = HomePage.GetHomePageValue<string>("registerButtonText");

    RegisterMemberModel model = TempData["Model"] as RegisterMemberModel;
    if (model == null)
    {
        model = new RegisterMemberModel(HomePage);
    }
}

@Html.Partial("Content")

<div class="container">
    @using (Html.BeginUmbracoForm("Register", "Account", FormMethod.Post))
    {
        @Html.AntiForgeryToken()

        @Html.ValidationSummary("", new { @class = "text-danger" })

        @Html.Partial("MemberForm", new OdkUmbracoTemplateModel<MemberModel>(model, Umbraco))

        <div>
            <button type="submit" class="btn btn-primary">@registerButtonText</button>
        </div>
    }
</div>